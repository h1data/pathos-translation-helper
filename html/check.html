<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta http-equiv="Content-Type" content="script/html; charset=utf-8">
    <meta http-equiv="Content-Language" content="ja">
    <title><?= text.title; ?></title>
    <?!= HtmlService.createHtmlOutputFromFile('html/style').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('html/loader').getContent(); ?>
    <script type="text/javascript">
      window.onload = function(){
        toggleAnimation('loadSpan', 'loadSvg');
        var id = '<?= getId(); ?>';
        var mode = '<?= getMode(); ?>';
        if (mode == '2') document.getElementById('provisional').hidden = false;
        google.script.run
          .withSuccessHandler(
            function (data) {
              toggleAnimation('loadSpan', 'loadSvg');
              document.getElementById('result').hidden = false;
              if (data.size == 0) {
                document.getElementById('message').textContent = '<?= text.check.noResult; ?>';
                return;
              }
              let table = document.getElementById('result-table-body');
              for(var i=0; i<data.length; i++) {
                var tr = document.createElement('tr');
                var isCritical = /Name$/.test(data[i][1]) && data[i][1] != 'ClassName' && data[i][1] != 'RaceName';
                for(var j=0; j<4; j++){
                  var td = document.createElement('td');
                  td.append(data[i][j]);
                  if(j == 0) td.classList.add('line');
                  if(isCritical) td.classList.add('warn');
                  tr.append(td);
                }
                table.append(tr);
              }
              document.getElementById('message').textContent = '<?= text.check.normal; ?>';
            }
          )
          .withFailureHandler(
            function(content) {
              toggleAnimation('loadSpan', 'loadSvg');
              document.getElementById('message').textContent = '<?= text.check.failed; ?>';
            }
          )
          .checkDuplicates(id, mode);
      }
    </script>
  </head>
  <body>
    <h2><?= text.title; ?></h2>
    <div id="provisional" hidden><?= text.check.provisional; ?></div>
    <span id="loadSpan"><svg id="loadSvg" width="1.0em" height="1.0em" xmlns="http://www.w3.org/2000/svg"></svg></span>
    <span id="message"><?= text.check.checking; ?></span>
    <div id="result" hidden>
      <table id="result-table-head">
        <thead>
          <tr>
            <th><?= text.check.headers[0]; ?></th>
            <th><?= text.check.headers[1]; ?></th>
            <th><?= text.check.headers[2]; ?></th>
            <th><?= text.check.headers[3]; ?></th>
          </tr>
        </thead>
          <tbody id="result-table-body" />
      </table>
    </div>
  </body>
</html>
